
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flowers DZ – معرض</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap: 14px; }
    .grid img, .grid video { width:100%; border-radius:12px; box-shadow: 0 2px 8px rgba(0,0,0,.06); }
    .lightbox { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.7); }
    .lightbox img, .lightbox video { max-width:92vw; max-height:88vh; border-radius:12px; }
  </style>
</head>
<body class="container py-4">
  <h2 class="mb-3">معرض منتجاتنا</h2>
  <div id="gallery" class="grid"></div>

  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    const config = {
      apiKey: "${FIREBASE_API_KEY}",
      authDomain: "${FIREBASE_AUTH_DOMAIN}",
      databaseURL: "${FIREBASE_DB_URL}",
      projectId: "${FIREBASE_PROJECT_ID}",
      storageBucket: "${FIREBASE_STORAGE_BUCKET}",
      messagingSenderId: "${FIREBASE_SENDER_ID}",
      appId: "${FIREBASE_APP_ID}",
    };

    const app = initializeApp(config);
    const db = getDatabase(app);

    const gallery = document.getElementById('gallery');
    const lightbox = document.getElementById('lightbox');

    onValue(ref(db, 'media'), (snap)=>{
      const data = snap.val() || {};
      const items = Object.entries(data).sort((a,b)=> (a[1].order||0)-(b[1].order||0));
      gallery.innerHTML = '';
      for(const [key,item] of items){
        if(item.type === 'image'){
          const img = document.createElement('img');
          img.src = item.url + '?tr=w-600,fo-auto';
          img.alt = item.alt || '';
          img.loading = 'lazy';
          img.onclick = ()=> openBox(`<img src="${item.url}?tr=w-1400,fo-auto" alt="${img.alt}">`);
          gallery.appendChild(img);
        } else {
          const vid = document.createElement('video');
          vid.src = item.url;
          vid.preload = 'metadata';
          vid.controls = true;
          vid.onclick = ()=> openBox(`<video src="${item.url}" controls autoplay></video>`);
          gallery.appendChild(vid);
        }
      }
    });

    function openBox(html){ lightbox.innerHTML = html; lightbox.style.display='flex'; }
    lightbox.addEventListener('click', ()=>{ lightbox.style.display='none'; lightbox.innerHTML=''; });
  </script>
</body>
</html>